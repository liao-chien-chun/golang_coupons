# Coupon System å„ªæƒ åˆ¸ç³»çµ±

é€™æ˜¯ä¸€å€‹ä½¿ç”¨ Golang + Gin + MySQL + Redis æ‰“é€ çš„ç°¡æ˜“å„ªæƒ åˆ¸ç³»çµ±ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- ä½¿ç”¨è€…å¯é ˜å–å¤šç¨®å„ªæƒ åˆ¸ï¼ˆå¦‚æ»¿é¡æŠ˜æŠµã€æŠ˜æ‰£åˆ¸ï¼‰ï¼Œæ¯å¼µåˆ¸æœ‰æ•¸é‡é™åˆ¶ã€‚
- ä½¿ç”¨è€…å¯æ–¼æœ‰æ•ˆæœŸé™å…§ä½¿ç”¨å„ªæƒ åˆ¸ï¼Œç³»çµ±æœƒé©—è­‰å¯ç”¨æ€§ï¼ˆå¦‚éæœŸæˆ–å·²ä½¿ç”¨ï¼‰ã€‚
- æä¾›æŸ¥è©¢ API é¡¯ç¤ºä½¿ç”¨è€…æ‰€æœ‰å„ªæƒ åˆ¸ç‹€æ…‹ï¼ˆæœªä½¿ç”¨ã€å·²ä½¿ç”¨ã€å·²éæœŸï¼‰ã€‚

---

## ğŸ“¦ å°ˆæ¡ˆæ¶æ§‹ç°¡ä»‹

```
coupon-system/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ seed/            # ç¨®å­è³‡æ–™ç¨‹å¼
â”œâ”€â”€ config/              # DBè¨­å®š
â”œâ”€â”€ controllers/         # API æ§åˆ¶å™¨
â”œâ”€â”€ models/              # GORM æ¨¡å‹
â”œâ”€â”€ routes/              # è·¯ç”±å®šç¾©
â”œâ”€â”€ Dockerfile           # Golang æ‡‰ç”¨å®¹å™¨
â”œâ”€â”€ docker-compose.yml   # ä¸€éµå•Ÿå‹• MySQLã€Redisã€Appã€Nginx
â””â”€â”€ README.md            # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
```

---

## ğŸš€ å¦‚ä½•å•Ÿå‹•å°ˆæ¡ˆ

### 1ï¸âƒ£ Clone å°ˆæ¡ˆ

```bash
git clone https://github.com/ä½ çš„å¸³è™Ÿ/coupon-system.git
cd coupon-system
```

### 2ï¸âƒ£ å•Ÿå‹•å®¹å™¨

```bash
docker-compose up -d --build
```

- Gin æ‡‰ç”¨é è¨­åœ¨ `http://localhost:8082` (æ‰“api è·¯å¾‘ç”¨é€™å€‹)
- Nginx ä½œç‚ºåå‘ä»£ç†ï¼Œé è¨­ä»£ç†åˆ°å®¹å™¨å…§çš„ port `8080`

### 3ï¸âƒ£ åŸ·è¡Œç¨®å­è³‡æ–™ï¼ˆå»ºç«‹ä½¿ç”¨è€…ã€å„ªæƒ åˆ¸ã€ä½¿ç”¨ç´€éŒ„ï¼‰

```bash
docker-compose exec app go run cmd/seed/seed.go
```

---

## ğŸ“Œ API èªªæ˜

ç›®å‰ç³»çµ±ç‚ºç°¡æ˜“æ¨¡æ“¬ç™»å…¥ï¼Œ**æ‰€æœ‰æ“ä½œçš†é è¨­ç‚º User ID = 1**

### âœ… é ˜å–å„ªæƒ åˆ¸

- **è·¯ç”±**ï¼š`POST /coupons/:id/redeem`
- **èªªæ˜**ï¼šé ˜å–ä¸€å¼µæŒ‡å®šå„ªæƒ åˆ¸

#### æˆåŠŸç¯„ä¾‹ï¼š

```json
{
  "success": true,
  "status": 200,
  "message": "å„ªæƒ åˆ¸é ˜å–æˆåŠŸ"
}
```

#### å¤±æ•—ç¯„ä¾‹ï¼ˆå·²é ˜éï¼‰ï¼š

```json
{
  "success": false,
  "status": 409,
  "message": "é ˜å–å¤±æ•—",
  "error": "å·²é ˜å–éè©²å„ªæƒ åˆ¸"
}
```

---

### ğŸ§¾ ä½¿ç”¨å„ªæƒ åˆ¸

- **è·¯ç”±**ï¼š`POST /coupons/:id/use`
- **èªªæ˜**ï¼šä½¿ç”¨æŒ‡å®šå·²é ˜å–çš„å„ªæƒ åˆ¸

#### æˆåŠŸç¯„ä¾‹ï¼š

```json
{
  "success": true,
  "status": 200,
  "message": "å„ªæƒ åˆ¸ä½¿ç”¨æˆåŠŸ"
}
```

#### å¤±æ•—ç¯„ä¾‹ï¼ˆå·²éæœŸï¼‰ï¼š

```json
{
  "success": false,
  "status": 400,
  "message": "ä½¿ç”¨å¤±æ•—",
  "error": "å„ªæƒ åˆ¸å·²éæœŸæˆ–å°šæœªé–‹å§‹"
}
```

---

### ğŸ” æŸ¥è©¢ä½¿ç”¨è€…çš„å„ªæƒ åˆ¸ç‹€æ…‹

- **è·¯ç”±**ï¼š`GET /users/:id/coupons`
- **èªªæ˜**ï¼šåˆ—å‡ºæ‰€æœ‰è©²ä½¿ç”¨è€…æ“æœ‰çš„å„ªæƒ åˆ¸åŠç‹€æ…‹

#### æˆåŠŸç¯„ä¾‹ï¼š

```json
{
  "success": true,
  "status": 200,
  "message": "æŸ¥è©¢æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "name": "æ»¿100æŠ˜20",
      "start_at": "2025-06-10T00:00:00Z",
      "end_at": "2025-06-20T00:00:00Z",
      "status": "unused"
    },
    {
      "id": 2,
      "name": "æ»¿200æŠ˜50",
      "status": "used"
    },
    {
      "id": 6,
      "name": "7æŠ˜é©šå–œåˆ¸",
      "status": "expired"
    }
  ]
}
```

---

## ğŸ§  ç³»çµ±è¨­è¨ˆå‚™è¨»

- **é˜²æ­¢è¶…ç™¼ï¼š** ä½¿ç”¨ Redis `SETNX` æ­é…åˆ¸é–å¯¦ç¾ã€‚
- **Redis å¿«å–å„ªæƒ åˆ¸è³‡æ–™**ï¼Œæ•ˆæœŸ 10 åˆ†é˜ã€‚
- **è³‡æ–™è¡¨é—œè¯ï¼š**
  - `users`: ä½¿ç”¨è€…åŸºæœ¬è³‡æ–™
  - `coupons`: å„ªæƒ åˆ¸å…§å®¹èˆ‡é™åˆ¶
  - `coupon_usages`: ä½¿ç”¨è€…èˆ‡å„ªæƒ åˆ¸çš„é—œè¯ã€ä½¿ç”¨ç‹€æ…‹

---

Â© 2025 Eric Liao